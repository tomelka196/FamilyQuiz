<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>We Love The World - Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK v8 - Most stable for static hosting -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        body { font-family: 'Merriweather', serif; margin: 0; padding: 0; }
        .font-oswald { font-family: 'Oswald', sans-serif; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .timer-pulse { animation: pulse 1s ease-in-out infinite; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        // Global app variable
        let app;
        
        // Wait for Firebase SDK to load
        window.addEventListener('load', function() {
            // Check if Firebase is loaded
            if (typeof firebase === 'undefined') {
                document.getElementById('root').innerHTML = '<div style="padding: 20px; text-align: center;"><h1>Chyba naÄÃ­tÃ¡nÃ­ Firebase / Firebase loading error</h1><p>Zkuste obnovit strÃ¡nku / Try refreshing the page</p></div>';
                console.error('Firebase SDK failed to load');
                return;
            }

            // Firebase Configuration
            const firebaseConfig = {
                apiKey: "AIzaSyAA-7YU1mkJoyfp27egxLGeaZ9w-XlJsHk",
                authDomain: "familyquiz-7286e.firebaseapp.com",
                databaseURL: "https://familyquiz-7286e-default-rtdb.europe-west1.firebasedatabase.app",
                projectId: "familyquiz-7286e",
                storageBucket: "familyquiz-7286e.firebasestorage.app",
                messagingSenderId: "613041565722",
                appId: "1:613041565722:web:9fb4c6ae3b814b8bfaa1a3"
            };

            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            const gameRef = database.ref('game');

        const CATEGORIES = [
            { id: 1, name: 'Geography & Landmarks', icon: 'ğŸŒ', type: 'knowledge', points: 10 },
            { id: 2, name: 'Music Through Decades', icon: 'ğŸµ', type: 'buzzer', points: 12 },
            { id: 3, name: 'Food & Traditions', icon: 'ğŸ•', type: 'knowledge', points: 10 },
            { id: 4, name: 'Famous People', icon: 'ğŸ‘¥', type: 'knowledge', points: 10 },
            { id: 5, name: 'Movies & TV', icon: 'ğŸ¬', type: 'buzzer', points: 15 },
            { id: 6, name: 'Nature & Animals', icon: 'ğŸŒ²', type: 'knowledge', points: 10 },
            { id: 7, name: 'History Highlights', icon: 'â°', type: 'knowledge', points: 10 }
        ];

        const QUESTIONS = {
            1: { // Geography
                1: { cz: 'Ve kterÃ© zemi se nachÃ¡zÃ­ Eiffelova vÄ›Å¾?', it: 'In quale paese si trova la Torre Eiffel?', answers: ['Francie / Francia', 'NÄ›mecko / Germania', 'ItÃ¡lie / Italia', 'Å panÄ›lsko / Spagna'], correct: 0 },
                2: { cz: 'VÄ›ÄnÃ© mÄ›sto na sedmi pahorcÃ­ch, kde kdysi vlÃ¡dli cÃ­saÅ™ovÃ© a gladiÃ¡toÅ™i bojovali v arÃ©nÃ¡ch. KterÃ© mÄ›sto to je?', it: 'La cittÃ  eterna su sette colli, dove imperatori governarono e gladiatori combatterono. Quale cittÃ  Ã¨?', answers: ['AtÃ©ny / Atene', 'Å˜Ã­m / Roma', 'Istanbul', 'KÃ¡hira / Cairo'], correct: 1, hints: [{type:'image',content:'https://lh3.googleusercontent.com/d/1fN17ROTReni7sfi44IUou6StbzSXTlH6'},{type:'text',content:'ğŸ’¡ NachÃ¡zÃ­ se v ItÃ¡lii'}] },
                3: { cz: 'Tento oceÃ¡n je nejvÄ›tÅ¡Ã­ na planetÄ›, pokrÃ½vÃ¡ vÃ­ce neÅ¾ tÅ™etinu zemskÃ©ho povrchu. JakÃ½ oceÃ¡n to je?', it: 'Questo oceano Ã¨ il piÃ¹ grande del pianeta, copre piÃ¹ di un terzo della superficie terrestre. Quale oceano Ã¨?', answers: ['TichÃ½ / Pacifico', 'IndickÃ½ / Indiano', 'AtlantskÃ½ / Atlantico', 'SevernÃ­ ledovÃ½ / Artico'], correct: 0, hints: [{type:'text',content:'ğŸ’¡ LeÅ¾Ã­ mezi Amerikou a AsiÃ­'},{type:'image',content:'https://lh3.googleusercontent.com/d/1o2kJPFS1U3XaUvoOUzAt04UfGIUtBfmI'}] },
                4: { cz: 'VlnÃ­cÃ­ se kopce, vinice a aleje cypÅ™iÅ¡Å¯. Odtud pochÃ¡zÃ­ slavnÃ© ÄervenÃ© vÃ­no z hroznÅ¯ Sangiovese. KterÃ¡ italskÃ¡ oblast je s touto krajinou spojenÃ¡?', it: 'Colline ondulate, vigneti e viali di cipressi. Da qui proviene il famoso vino rosso dai vitigni Sangiovese. Quale regione italiana Ã¨ associata a questo paesaggio?', answers: ['Piemonte', 'ToskÃ¡nsko / Toscana', 'SicÃ­lie / Sicilia', 'BenÃ¡tsko / Veneto'], correct: 1, hints: [{type:'text',content:'ğŸ’¡ VÃ­no se jmenuje Chianti'},{type:'image',content:'https://lh3.googleusercontent.com/d/1vfx5ov4HuJVptGK0IjJKX9wHfPczf9_x'}] },
                5: { cz: 'Tato hora, kterÃ¡ se tyÄÃ­ na hranici NepÃ¡lu a Tibetu, je nazÃ½vÃ¡na "Matka bohynÄ› svÄ›ta". JejÃ­ vrchol dosahuje 8 849 metrÅ¯. KterÃ¡ hora to je?', it: 'Questa montagna, che si erge al confine tra Nepal e Tibet, Ã¨ chiamata "Madre dea del mondo". La sua vetta raggiunge 8 849 metri. Quale montagna Ã¨?', answers: ['K2', 'Mount Everest', 'KilimandÅ¾Ã¡ro / Kilimangiaro', 'Mont Blanc'], correct: 1, hints: [{type:'text',content:'ğŸ’¡ Je to nejvyÅ¡Å¡Ã­ hora svÄ›ta'},{type:'image',content:'https://lh3.googleusercontent.com/d/1kp6xldPTHfQAdvSfm48J4XR2sJqGJEwy'}] }
            },
            2: { // Music
                1: { cz: 'UhÃ¡dnÄ›te pÃ­sniÄku', it: 'Indovina la canzone', type: 'buzzer', visual: 'ğŸ‘‘ğŸ’ƒ', answer: 'Dancing Queen (ABBA)', image: 'https://lh3.googleusercontent.com/d/19g1qQ2MbO6T7rbh2iA7lzE3TOZnBJR-F' },
                2: { cz: 'UhÃ¡dnÄ›te pÃ­sniÄku', it: 'Indovina la canzone', type: 'buzzer', visual: 'ğŸ‘¥ğŸ†', answer: 'We Are The Champions (Queen)', image: 'https://lh3.googleusercontent.com/d/1BRH8B9FeIm4StgdbdYUS41jz1Drk3zFa' },
                3: { cz: 'UhÃ¡dnÄ›te pÃ­sniÄku', it: 'Indovina la canzone', type: 'buzzer', visual: 'ğŸ‘–ğŸ‘©', answer: 'Thriller (Michael Jackson)', image: 'https://lh3.googleusercontent.com/d/1HuNZOUk-POnrEFrokZZm_jRXNfqizStn' },
                4: { cz: 'UhÃ¡dnÄ›te pÃ­sniÄku', it: 'Indovina la canzone', type: 'buzzer', visual: 'ğŸ‰âš¡â›ˆï¸', answer: 'Thunder (Imagine Dragons)', image: 'https://lh3.googleusercontent.com/d/1qOcxxo0DTPBXxMgBUTPf6hWH5moU2gsz' },
                5: { cz: 'UhÃ¡dnÄ›te pÃ­sniÄku', it: 'Indovina la canzone', type: 'buzzer', visual: 'ğŸ“ğŸ‘¤', answer: 'Shape of You (Ed Sheeran)', image: 'https://lh3.googleusercontent.com/d/1j4Vg86oe7NwlHuPOpbZCa2VP3_kJxI_Q' }
            },
            3: { // Food
                1: { cz: 'JakÃ¡ je hlavnÃ­ pÅ™Ã­sada v tradiÄnÃ­m italskÃ©m rizotu?', it: 'Qual Ã¨ l\'ingrediente principale nel risotto italiano tradizionale?', answers: ['Brambory / Patate', 'RÃ½Å¾e / Riso', 'TÄ›stoviny / Pasta', 'Polenta'], correct: 1 },
                2: { cz: 'PochÃ¡zÃ­ ze zemÄ› vychÃ¡zejÃ­cÃ­ho slunce, pÅ™ipravuje se z rÃ½Å¾e a syrovÃ½ch ryb. Co to je?', it: 'Proviene dalla terra del sol levante, si prepara con riso e pesce crudo. Cos\'Ã¨?', answers: ['Sushi', 'Ramen', 'Tempura', 'Sashimi'], correct: 0, hints: [{type:'text',content:'ğŸ’¡ JÃ­ se hÅ¯lkami'},{type:'image',content:'https://lh3.googleusercontent.com/d/1CfWs_qfzNySH2Fq3f8XOWGE3D8KUK3B5'}] },
                3: { cz: 'Zraje pod srpnovÃ½m sluncem a jeho vÅ¯nÄ› naplnÃ­ celou chalupu. KdyÅ¾ pÅ™ijde Äas, stÃ¡vÃ¡ se z nÄ›ho tekutÃ½ poklad â€” ale jen pro ty trpÄ›livÃ©. Co vznikÃ¡ tÃ­mto tradiÄnÃ­m zpÅ¯sobem?', it: 'Matura sotto il sole di agosto e il suo profumo riempie tutta la casa di campagna. Quando arriva il momento, diventa un tesoro liquido â€” ma solo per i pazienti. Cosa nasce in questo modo tradizionale?', answers: ['Povidla / Marmellata di prugne', 'Slivovice / Grappa di prugne', 'HruÅ¡kovice / Grappa di pere', 'DÅ¾em / Confettura'], correct: 1, hints: [{type:'text',content:'ğŸ’¡ Obsahuje alkohol'},{type:'image',content:'https://lh3.googleusercontent.com/d/1x-HxmchEGs4AGtd9C_v_LdrukKFGKqYB'}] },
                4: { cz: 'TvrdÃ½, dozrÃ¡vajÃ­cÃ­ sÃ½r s nezamÄ›nitelnou chutÃ­, kterÃ½ nese chrÃ¡nÄ›nÃ© oznaÄenÃ­ pÅ¯vodu. Zraje v srdci ItÃ¡lie a nese jmÃ©no svÃ©ho kraje. Jak se jmenuje?', it: 'Formaggio duro, stagionato con un gusto inconfondibile, che porta la denominazione di origine protetta. Matura nel cuore dell\'Italia e porta il nome della sua regione. Come si chiama?', answers: ['Parmigiano Reggiano', 'Gorgonzola', 'Mozzarella', 'Grana Padano'], correct: 0, hints: [{type:'text',content:'ğŸ’¡ StrouhÃ¡ se na tÄ›stoviny'},{type:'image',content:'https://lh3.googleusercontent.com/d/10sPQMLXLfRF88mHtK7DS5MD2gWKWTEmu'}] },
                5: { cz: 'Tento tradiÄnÃ­ ÄeskÃ½ pokrm se servÃ­ruje v den, kdy se vÅ¡ichni postÃ­me, abychom veÄer vidÄ›li zlatÃ© prasÃ¡tko. SklÃ¡dÃ¡ se z Å¾ivoÄicha Å¾ijÃ­cÃ­ho ve vodÄ› s pÅ™Ã­lohou salÃ¡tovou. Co je to?', it: 'Questo piatto tradizionale ceco si serve nel giorno in cui tutti digiunano per vedere il maialino d\'oro la sera. Si compone di un animale acquatico con contorno di insalata. Cos\'Ã¨?', answers: ['Humr', 'Chobotnice', 'Kapr', 'TuÅˆÃ¡k'], correct: 2, hints: [{type:'text',content:'ğŸ’¡ Je to sladkovodnÃ­ ryba'},{type:'image',content:'https://lh3.googleusercontent.com/d/1uWiviULENkpqoppWAmaVz32mmnQvcIJR'}] }
            },
            4: { // Famous People
                1: { cz: 'Kdo namaloval Monu Lisu?', it: 'Chi ha dipinto la Gioconda?', answers: ['Michelangelo', 'Leonardo da Vinci', 'Raffaello', 'Caravaggio'], correct: 1 },
                2: { cz: 'Putoval peklem, oÄistcem i rÃ¡jem. Jeho verÅ¡e z 14. stoletÃ­ tvoÅ™Ã­ jednu z nejvÄ›tÅ¡Ã­ch literÃ¡rnÃ­ch poutÃ­ vÅ¯bec. Kdo je autorem tÃ©to cesty?', it: 'Ha viaggiato attraverso l\'inferno, il purgatorio e il paradiso. I suoi versi del XIV secolo formano uno dei piÃ¹ grandi viaggi letterari di tutti i tempi. Chi Ã¨ l\'autore di questo viaggio?', answers: ['Dante Alighieri', 'Petrarca', 'Boccaccio', 'Manzoni'], correct: 0, hints: [{type:'text',content:'ğŸ’¡ Jeho jmÃ©no zaÄÃ­nÃ¡ D'},{type:'image',content:'https://lh3.googleusercontent.com/d/1SztwUyzGgD-MEwHvDysjL_i0b7GYeDAR'}] },
                3: { cz: 'Vedl svou zemi v dobÄ› rozdÄ›lenÃ­ a utrpenÃ­. SvÃ½m podpisem zmÄ›nil osudy milionÅ¯ a stal se symbolem boje za svobodu. Kdo byl tÃ­mto americkÃ½m prezidentem?', it: 'Ha guidato il suo paese in un periodo di divisione e sofferenza. Con la sua firma ha cambiato il destino di milioni e Ã¨ diventato un simbolo della lotta per la libertÃ . Chi era questo presidente americano?', answers: ['Thomas Jefferson', 'George Washington', 'Abraham Lincoln', 'Benjamin Franklin'], correct: 2, hints: [{type:'text',content:'ğŸ’¡ Jeho tvÃ¡Å™ je na Mt. Rushmore'},{type:'image',content:'https://lh3.googleusercontent.com/d/1EMC8EgAlrBsMSTsAVavJTtrWnoqDo8Pt'}] },
                4: { cz: 'Tento slavnÃ½ skladatel pÅ™iÅ¡el o sluch, pÅ™esto vytvoÅ™il dÃ­la, kterÃ¡ dnes znÃ¡ celÃ½ svÄ›t. Kdo to byl?', it: 'Questo famoso compositore perse l\'udito, ma creÃ² opere che oggi conosce tutto il mondo. Chi era?', answers: ['Mozart', 'Bach', 'Beethoven', 'Vivaldi'], correct: 2, hints: [{type:'text',content:'ğŸ’¡ Jeho 9. symfonie je hymnou EU'},{type:'image',content:'https://lh3.googleusercontent.com/d/1bBDxYmssy5iCP7FymJLcs7au3HpCFUu6'}] },
                5: { cz: 'VÄ›dec s nezamÄ›nitelnÃ½m vzhledem, kterÃ½ navÅ¾dy zmÄ›nil pojetÃ­ prostoru, Äasu i energie. Jeho slavnÃ¡ rovnice je znÃ¡mÃ¡, ale jeho Å¾ivot plnÃ½ paradoxÅ¯ jeÅ¡tÄ› vÃ­ce. Kdo to byl?', it: 'Scienziato dall\'aspetto inconfondibile, che ha cambiato per sempre la concezione di spazio, tempo ed energia. La sua famosa equazione Ã¨ nota, ma la sua vita piena di paradossi ancora di piÃ¹. Chi era?', answers: ['Isaac Newton', 'Albert Einstein', 'Galileo Galilei', 'Stephen Hawking'], correct: 1, hints: [{type:'text',content:'ğŸ’¡ Dostal Nobelovu cenu za fyziku'},{type:'image',content:'https://lh3.googleusercontent.com/d/1FHuI9hQxTnx6bL5trkGYdkEO6czMeVaw'}] }
            },
            5: { // Movies
                1: { cz: 'UhÃ¡dnÄ›te film', it: 'Indovina il film', type: 'buzzer', visual: 'ğŸš¢â„ï¸', answer: 'Titanic', image: 'https://lh3.googleusercontent.com/d/1xeUquLRMucxea9In_xl0dhkiLzaFTKuU' },
                2: { cz: 'UhÃ¡dnÄ›te postavu', it: 'Indovina il personaggio', type: 'buzzer', visual: 'âš¡ğŸ‘“ğŸ§™â€â™‚ï¸', answer: 'Harry Potter', image: 'https://lh3.googleusercontent.com/d/1QoTlP3rWK55_C2Y72G-zyZIijTCsSwFs' },
                3: { cz: 'UhÃ¡dnÄ›te film', it: 'Indovina il film', type: 'buzzer', visual: 'ğŸ‘¹ğŸ§…', answer: 'Shrek', image: 'https://lh3.googleusercontent.com/d/1XDhsUSmlKgiJNhfG_3wb0QuGx3W4pkRV' },
                4: { cz: 'UhÃ¡dnÄ›te seriÃ¡l', it: 'Indovina la serie', type: 'buzzer', visual: 'ğŸ‰ğŸ‘‘âš”ï¸', answer: 'Game of Thrones', image: 'https://lh3.googleusercontent.com/d/1pHuQ12SYbauup20MWXyTcqH6jF8cRw_2' },
                5: { cz: 'UhÃ¡dnÄ›te superhrdinu', it: 'Indovina il supereroe', type: 'buzzer', visual: 'ğŸ¦‡ğŸ¦¸â€â™‚ï¸', answer: 'Batman', image: 'https://lh3.googleusercontent.com/d/1TkawDFNTGv9dcGnV79btWmJnaR-0I2CG' }
            },
            6: { // Nature
                1: { cz: 'JakÃ© je nejvÄ›tÅ¡Ã­ zvÃ­Å™e na svÄ›tÄ›?', it: 'Qual Ã¨ l\'animale piÃ¹ grande del mondo?', answers: ['Slon / Elefante', 'Å½irafa / Giraffa', 'ModrÃ¡ velryba / Balenottera azzurra', 'NosoroÅ¾ec / Rinoceronte'], correct: 2 },
                2: { cz: 'TichÃ½ tkadlec visÃ­cÃ­ mezi vÄ›tvemi. MÃ¡ osm konÄetin a mistrovskÃ© dÃ­lo z hedvÃ¡bÃ­. O kom je Å™eÄ?', it: 'Silenzioso tessitore appeso tra i rami. Ha otto arti e un capolavoro di seta. Di chi si parla?', answers: ['Mravenec / Formica', 'Pavouk / Ragno', 'StonoÅ¾ka / Millepiedi', 'Brouk / Scarafaggio'], correct: 1, hints: [{type:'text',content:'ğŸ’¡ LovÃ­ hmyz'},{type:'image',content:'https://lh3.googleusercontent.com/d/1fu6i8wBraTZj3JeC4BbDfk1H5qpoPs0L'}] },
                3: { cz: 'Å½ije tam, kde jinÃ­ zmrznou. NepotÅ™ebuje kÅ™Ã­dla k letu, protoÅ¾e ve vodÄ› je rychlejÅ¡Ã­ neÅ¾ vÄ›tÅ¡ina ryb. Kdo je tento obyvatel ledovÃ©ho krÃ¡lovstvÃ­?', it: 'Vive dove gli altri congelano. Non ha bisogno di ali per volare, perchÃ© in acqua Ã¨ piÃ¹ veloce della maggior parte dei pesci. Chi Ã¨ questo abitante del regno ghiacciato?', answers: ['MroÅ¾ / Tricheco', 'TuÄÅˆÃ¡k / Pinguino', 'LednÃ­ medvÄ›d / Orso polare', 'PolÃ¡rnÃ­ liÅ¡ka / Volpe artica'], correct: 1, hints: [{type:'text',content:'ğŸ’¡ Å½ije v nejchladnÄ›jÅ¡Ã­m mÃ­stÄ› na Zemi'},{type:'image',content:'https://lh3.googleusercontent.com/d/1_IgBBs54MXpn6m2r44gHYKev0NYZ2CtG'}] },
                4: { cz: 'VysokÃ½ tvor tiÅ¡e krÃ¡ÄÃ­ mezi stromy. Jeho krk se tyÄÃ­ nad krajinou, ale nikdo si nenÃ­ jistÃ½, kdo to vlastnÄ› je. KterÃ© zvÃ­Å™e to mÅ¯Å¾e bÃ½t?', it: 'Una creatura alta cammina silenziosamente tra gli alberi. Il suo collo si erge sopra il paesaggio, ma nessuno Ã¨ sicuro di chi sia veramente. Quale animale potrebbe essere?', answers: ['Brontosaurus', 'Å½irafa / Giraffa', 'Velbloud / Cammello', 'PÅ¡tros / Struzzo'], correct: 1, hints: [{type:'text',content:'ğŸ’¡ Je to nejvyÅ¡Å¡Ã­ zvÃ­Å™e na svÄ›tÄ›'},{type:'image',content:'https://lh3.googleusercontent.com/d/1AZ-ysk-Dz7PpOkEAt-Mou0-Cc7Ego9uW'}] },
                5: { cz: 'Tyto obrovskÃ© stromy mohou Å¾Ã­t vÃ­ce neÅ¾ 3000 let a dorÅ¯st vÃ½Å¡ky pÅ™es 100 metrÅ¯. Rostou v Kalifornii a patÅ™Ã­ k nejstarÅ¡Ã­m organismÅ¯m na planetÄ›. Jak se jmenujÃ­?', it: 'Questi alberi giganti possono vivere piÃ¹ di 3000 anni e raggiungere altezze superiori a 100 metri. Crescono in California e sono tra gli organismi piÃ¹ antichi del pianeta. Come si chiamano?', answers: ['Dub / Quercia', 'Borovice / Pino', 'Sekvoje / Sequoia', 'BÅ™Ã­za / Betulla'], correct: 2, hints: [{type:'text',content:'ğŸ’¡ Jejich kÅ¯ra je ÄervenohnÄ›dÃ¡'},{type:'image',content:'https://lh3.googleusercontent.com/d/1Wgenr4rMhSptU1zGyXi0XJiqBoGhj86y'}] }
            },
            7: { // History
                1: { cz: 'Ve kterÃ©m roce skonÄila 2. svÄ›tovÃ¡ vÃ¡lka?', it: 'In che anno Ã¨ finita la Seconda Guerra Mondiale?', answers: ['1943', '1944', '1945', '1946'], correct: 2 },
                2: { cz: 'BetonovÃ¡ bariÃ©ra, kterÃ¡ rozdÄ›lila mÄ›sto a svÄ›t na dvÄ› poloviny, padla jednÃ© listopadovÃ© noci za jÃ¡sotu davÅ¯. V kterÃ©m roce se zaÄaly drolit jejÃ­ zdi?', it: 'Una barriera di cemento che divise la cittÃ  e il mondo in due metÃ , cadde una notte di novembre tra il giubilo delle folle. In che anno iniziarono a sgretolarsi le sue mura?', answers: ['1987', '1989', '1991', '1993'], correct: 1, hints: [{type:'text',content:'ğŸ’¡ Stalo se to v BerlÃ­nÄ›'},{type:'image',content:'https://lh3.googleusercontent.com/d/1Wydj3kJJOoj4xw_qqyh_hlIzNedfcaa9'}] },
                3: { cz: 'Tento americkÃ½ astronaut prohlÃ¡sil v roce 1969: "To je malÃ½ krok pro ÄlovÄ›ka, ale obrovskÃ½ skok pro lidstvo." Kdo to byl?', it: 'Questo astronauta americano dichiarÃ² nel 1969: "Un piccolo passo per l\'uomo, un grande balzo per l\'umanitÃ ." Chi era?', answers: ['Louis Armstrong', 'Neil Armstrong', 'Lance Armstrong', 'John W. Armstrong'], correct: 1, hints: [{type:'text',content:'ğŸ’¡ Byl prvnÃ­ ÄlovÄ›k na MÄ›sÃ­ci'},{type:'image',content:'https://lh3.googleusercontent.com/d/1IynSoHj5FtB9gMfwfll1Hhh8EHk3oIp7'}] },
                4: { cz: 'Smlouva podepsanÃ¡ v historickÃ©m nizozemskÃ©m mÄ›stÄ› roku 1993 spojila nÃ¡rody do novÃ©ho celku. Jak se jmenuje organizace, kterÃ¡ z nÃ­ vznikla?', it: 'Un trattato firmato in una storica cittÃ  olandese nel 1993 ha unito le nazioni in un nuovo insieme. Come si chiama l\'organizzazione nata da esso?', answers: ['NATO', 'EvropskÃ¡ unie (EU)', 'OSN', 'Rada Evropy'], correct: 1, hints: [{type:'text',content:'ğŸ’¡ Smlouva se jmenuje MaastrichtskÃ¡'},{type:'image',content:'https://lh3.googleusercontent.com/d/1WZfoCmKnKFtWwSKwLaAqCET1EyxhJgWE'}] },
                5: { cz: 'TÅ™i lodÄ› tiÅ¡e prorÃ¡Å¾ely mlhu Atlantiku. Na palubÄ› posÃ¡dka, kterÃ¡ netuÅ¡ila, Å¾e mÄ›nÃ­ dÄ›jiny. V kterÃ©m roce se tato vÃ½prava vydala na cestu?', it: 'Tre navi silenziose attraversavano la nebbia dell\'Atlantico. A bordo un equipaggio che non sapeva di cambiare la storia. In che anno questa spedizione intraprese il viaggio?', answers: ['1492', '1500', '1520', '1534'], correct: 0, hints: [{type:'text',content:'ğŸ’¡ ObjevenÃ­ Ameriky / Scoperta dell\'America'},{type:'image',content:'https://lh3.googleusercontent.com/d/1nghpjz1PlTzGQ9xyyGqffv5UJfEuowWq'}] }
            }
        };

        class QuizApp {
            constructor() {
                this.view = 'select';
                this.teamId = null;
                this.gameData = null;
                this.timerInterval = null;
                this.hintInterval = null;
                this.countdownTimeout = null;
                this.gameTimerTimeout = null;
                this.lastRenderState = '';
                
                // Listen to Firebase changes
                gameRef.on('value', (snapshot) => {
                    const newData = snapshot.val();
                    if (!newData) {
                        // Initialize game if not exists
                        this.initializeGame();
                    } else {
                        const oldData = this.gameData;
                        this.gameData = newData;
                        
                        // Only render if something meaningful changed
                        const newState = JSON.stringify({
                            view: this.view,
                            gameState: newData.gameState,
                            countdown: newData.countdown,
                            currentLevel: newData.currentLevel,
                            currentCategory: newData.currentCategory,
                            timer: newData.timer,
                            timerActive: newData.timerActive,
                            team1Ready: newData.teams?.team1?.ready,
                            team2Ready: newData.teams?.team2?.ready,
                            team1Score: newData.teams?.team1?.score,
                            team2Score: newData.teams?.team2?.score
                        });
                        
                        if (newState !== this.lastRenderState) {
                            this.lastRenderState = newState;
                            this.render();
                        }
                    }
                });
            }

            initializeGame() {
                const initialData = {
                    gameState: 'welcome',
                    currentLevel: 1,
                    currentCategory: null,
                    countdown: 3,
                    timer: 60,
                    timerActive: false,
                    hintsShown: 0,
                    answers: {},
                    showCorrect: false,
                    buzzer: null,
                    teams: {
                        team1: { name: 'HrÃ¡Äi / Giocatori', score: 0, ready: false, completedCategories: [] },
                        team2: { name: 'HvÄ›zdy / Stelle', score: 0, ready: false, completedCategories: [] }
                    }
                };
                gameRef.set(initialData);
            }

            updateGameState(updates) {
                gameRef.update(updates);
            }

            setView(view) {
                this.view = view;
                this.render();
            }

            joinTeam(teamId) {
                this.teamId = teamId;
                gameRef.child(`teams/${teamId}/ready`).set(true);
                this.render();
            }

            startCountdown() {
                // Clear any existing timers first
                this.clearAllTimers();
                this.updateGameState({ gameState: 'countdown', countdown: 3 });
            }

            startTimer() {
                if (this.gameData.currentLevel === 1) return;
                this.updateGameState({ 
                    timerActive: true, 
                    timer: 60, 
                    hintsShown: 0 
                });
            }

            clearAllTimers() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
                if (this.hintInterval) {
                    clearInterval(this.hintInterval);
                    this.hintInterval = null;
                }
                if (this.countdownTimeout) {
                    clearTimeout(this.countdownTimeout);
                    this.countdownTimeout = null;
                }
                if (this.gameTimerTimeout) {
                    clearTimeout(this.gameTimerTimeout);
                    this.gameTimerTimeout = null;
                }
            }

            pressBuzzer(teamId) {
                if (!this.gameData.buzzer) {
                    this.updateGameState({ buzzer: teamId });
                }
            }

            submitAnswer(teamId, answer) {
                const key = `${teamId}-${this.gameData.currentLevel}-${this.gameData.currentCategory}`;
                gameRef.child(`answers/${key}`).set(answer);
            }

            awardPoints(teamId, points) {
                const currentScore = this.gameData.teams[teamId].score;
                gameRef.child(`teams/${teamId}/score`).set(currentScore + points);
                this.nextQuestion();
            }

            showCorrectAnswer() {
                this.updateGameState({ showCorrect: true });
            }

            selectCategory(categoryId) {
                const team1Key = `team1-${this.gameData.currentLevel}-${categoryId}`;
                const team2Key = `team2-${this.gameData.currentLevel}-${categoryId}`;
                const isCompleted = this.gameData.answers && 
                                   (this.gameData.answers[team1Key] !== undefined || 
                                    this.gameData.answers[team2Key] !== undefined);
                
                if (isCompleted) return;

                this.updateGameState({
                    currentCategory: categoryId,
                    timer: 60,
                    timerActive: false,
                    hintsShown: 0,
                    showCorrect: false,
                    buzzer: null
                });
            }

            nextQuestion() {
                const completedCount = Object.keys(this.gameData.answers || {})
                    .filter(k => k.includes(`-${this.gameData.currentLevel}-`)).length;
                
                if (completedCount >= 14) {
                    this.updateGameState({ gameState: 'levelEnd' });
                } else {
                    this.updateGameState({
                        currentCategory: null,
                        timer: 60,
                        timerActive: false,
                        hintsShown: 0,
                        showCorrect: false,
                        buzzer: null
                    });
                }
            }

            nextLevel() {
                if (this.gameData.currentLevel >= 5) {
                    this.updateGameState({ gameState: 'finished' });
                } else {
                    this.updateGameState({
                        currentLevel: this.gameData.currentLevel + 1,
                        currentCategory: null,
                        gameState: 'playing',
                        timer: 60,
                        timerActive: false,
                        hintsShown: 0,
                        showCorrect: false,
                        buzzer: null
                    });
                }
            }

            calculatePoints() {
                if (!this.gameData) return 0;
                const level = this.gameData.currentLevel;
                const cat = CATEGORIES.find(c => c.id === this.gameData.currentCategory);
                return cat ? cat.points * level : 0;
            }

            resetAll() {
                if (confirm('Opravdu chcete resetovat celou hru? / Vuoi davvero resettare l\'intero gioco?')) {
                    gameRef.remove().then(() => {
                        this.view = 'select';
                        this.teamId = null;
                        this.initializeGame();
                    });
                }
            }

            render() {
                const root = document.getElementById('root');
                if (!root || !this.gameData) return;
                
                root.innerHTML = '';
                
                if (this.view === 'select') {
                    root.innerHTML = this.renderViewSelect();
                } else if (this.view === 'host') {
                    root.innerHTML = this.renderHost();
                    this.handleTimers();
                } else if (this.view === 'team') {
                    root.innerHTML = this.renderTeam();
                }
            }

            handleTimers() {
                // Only HOST controls timers
                if (this.view !== 'host') return;
                
                const d = this.gameData;
                if (!d) return;
                
                // Countdown timer
                if (d.gameState === 'countdown' && d.countdown > 0) {
                    if (!this.countdownTimeout) {
                        this.countdownTimeout = setTimeout(() => {
                            const newCountdown = d.countdown - 1;
                            if (newCountdown === 0) {
                                this.updateGameState({ countdown: 0, gameState: 'playing' });
                            } else {
                                this.updateGameState({ countdown: newCountdown });
                            }
                            this.countdownTimeout = null;
                        }, 1000);
                    }
                } else if (d.gameState !== 'countdown' && this.countdownTimeout) {
                    clearTimeout(this.countdownTimeout);
                    this.countdownTimeout = null;
                }
                
                // Game timer (for levels 2-5)
                if (d.currentLevel > 1 && d.timerActive && d.timer > 0 && d.gameState === 'playing' && d.currentCategory) {
                    if (!this.gameTimerTimeout) {
                        this.gameTimerTimeout = setTimeout(() => {
                            const newTimer = d.timer - 1;
                            
                            // Check for hints
                            const elapsed = 60 - newTimer;
                            const q = QUESTIONS[d.currentCategory]?.[d.currentLevel];
                            let updates = { timer: newTimer };
                            
                            if (q?.hints) {
                                if (elapsed === 20 && d.hintsShown === 0) {
                                    updates.hintsShown = 1;
                                } else if (elapsed === 40 && d.hintsShown === 1) {
                                    updates.hintsShown = 2;
                                }
                            }
                            
                            if (newTimer === 0) {
                                updates.timerActive = false;
                            }
                            
                            this.updateGameState(updates);
                            this.gameTimerTimeout = null;
                        }, 1000);
                    }
                } else if ((!d.timerActive || !d.currentCategory) && this.gameTimerTimeout) {
                    clearTimeout(this.gameTimerTimeout);
                    this.gameTimerTimeout = null;
                }
            }
                            if (elapsed === 20 && this.gameData.hintsShown === 0) {
                                this.updateGameState({ hintsShown: 1 });
                            } else if (elapsed === 40 && this.gameData.hintsShown === 1) {
                                this.updateGameState({ hintsShown: 2 });
                                clearInterval(this.hintInterval);
                                this.hintInterval = null;
                            }
                        }, 1000);
                    }
                }
                
                // Clean up intervals
                if (!d.timerActive && this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
                if (!d.timerActive && this.hintInterval) {
                    clearInterval(this.hintInterval);
                    this.hintInterval = null;
                }
            }

            renderViewSelect() {
                return `<div class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-8">
                    <div class="max-w-2xl w-full"><div class="text-center mb-12"><div class="text-8xl mb-6">ğŸŒ</div>
                    <h1 class="text-7xl font-bold text-white mb-4 font-oswald" style="text-shadow: 0 0 20px rgba(255,255,255,0.3)">WE LOVE THE WORLD</h1></div>
                    <div class="grid gap-6">
                    <button onclick="app.setView('host')" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-gray-900 text-2xl font-bold py-8 px-8 rounded-2xl hover:scale-105 transition-all shadow-2xl font-oswald">ğŸ† HOST</button>
                    <button onclick="app.setView('team')" class="bg-gradient-to-r from-green-400 to-blue-500 text-white text-2xl font-bold py-8 px-8 rounded-2xl hover:scale-105 transition-all shadow-2xl font-oswald">ğŸ‘¥ TÃM</button>
                    <button onclick="app.resetAll()" class="bg-gradient-to-r from-red-500 to-pink-600 text-white text-xl font-bold py-4 px-8 rounded-2xl hover:scale-105 transition-all shadow-2xl font-oswald">ğŸ”„ RESET CELÃ‰ HRY</button>
                    </div>
                    <div class="text-center mt-8 text-gray-400 text-sm opacity-70">Â© 2025 Created by TOOM & Claude.ai</div>
                    </div></div>`;
            }

            renderHost() {
                const d = this.gameData;
                if (d.gameState === 'welcome') {
                    return `<div class="min-h-screen bg-gradient-to-br from-purple-900 to-indigo-900 text-white p-12"><div class="max-w-6xl mx-auto text-center">
                    <div class="text-9xl mb-6 animate-bounce">ğŸŒ</div><h1 class="text-8xl font-bold mb-12 font-oswald" style="background: linear-gradient(to right, #fbbf24, #f97316); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">WE LOVE THE WORLD</h1>
                    <div class="grid grid-cols-2 gap-6 mb-8">
                    <div class="p-6 rounded-xl ${d.teams.team1.ready ? 'bg-green-500' : 'bg-gray-700'}"><p class="text-2xl font-bold">${d.teams.team1.name}</p><p class="text-xl">${d.teams.team1.ready ? 'âœ“ Ready' : 'â³ Waiting'}</p></div>
                    <div class="p-6 rounded-xl ${d.teams.team2.ready ? 'bg-green-500' : 'bg-gray-700'}"><p class="text-2xl font-bold">${d.teams.team2.name}</p><p class="text-xl">${d.teams.team2.ready ? 'âœ“ Ready' : 'â³ Waiting'}</p></div>
                    </div>
                    ${d.teams.team1.ready && d.teams.team2.ready ? '<button onclick="app.startCountdown()" class="bg-gradient-to-r from-green-400 to-blue-500 text-white text-4xl font-bold py-8 px-16 rounded-2xl font-oswald animate-pulse">ğŸš€ START</button>' : ''}
                    <div class="text-center mt-12 text-gray-400 text-sm opacity-70">Â© 2025 Created by TOOM & Claude.ai</div>
                    </div></div>`;
                }
                if (d.gameState === 'countdown') {
                    return `<div class="min-h-screen bg-gradient-to-br from-red-900 to-yellow-900 flex items-center justify-center"><h1 class="text-[20rem] font-bold text-white animate-bounce font-oswald">${d.countdown > 0 ? d.countdown : 'ğŸ‰'}</h1></div>`;
                }
                if (d.gameState === 'playing') {
                    if (!d.currentCategory) {
                        return `<div class="min-h-screen bg-gradient-to-br from-indigo-900 to-purple-900 text-white p-8"><div class="max-w-7xl mx-auto">
                        <div class="flex justify-between items-center mb-8">
                        <div class="text-3xl font-bold">LEVEL ${d.currentLevel}/5</div>
                        <div class="grid grid-cols-2 gap-6">
                        <div class="text-xl font-bold">${d.teams.team1.name}: ${d.teams.team1.score}</div>
                        <div class="text-xl font-bold">${d.teams.team2.name}: ${d.teams.team2.score}</div>
                        </div>
                        </div>
                        <h2 class="text-5xl font-bold text-center mb-12 font-oswald">VYBERTE KATEGORII / SCEGLI CATEGORIA</h2>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                        ${CATEGORIES.map(cat => {
                            const team1Key = `team1-${d.currentLevel}-${cat.id}`;
                            const team2Key = `team2-${d.currentLevel}-${cat.id}`;
                            const isCompleted = d.answers && (d.answers[team1Key] !== undefined || d.answers[team2Key] !== undefined);
                            return `<button onclick="app.selectCategory(${cat.id})" ${isCompleted ? 'disabled' : ''} class="relative ${isCompleted ? 'bg-gray-600 opacity-50 cursor-not-allowed' : 'bg-gradient-to-br from-blue-500 to-purple-600 hover:scale-105'} text-2xl font-bold py-12 px-6 rounded-2xl transition-all font-oswald">
                            <div class="text-6xl mb-3">${cat.icon}</div>
                            <div>${cat.name}</div>
                            <div class="text-yellow-400 mt-2">ğŸ’ ${cat.points * d.currentLevel}</div>
                            ${isCompleted ? '<div class="absolute top-4 right-4 text-4xl">âœ“</div>' : ''}
                            </button>`;
                        }).join('')}
                        </div>
                        </div></div>`;
                    }
                    
                    const cat = CATEGORIES.find(c => c.id === d.currentCategory);
                    const q = QUESTIONS[d.currentCategory][d.currentLevel];
                    const isLevel1 = d.currentLevel === 1;
                    
                    if (cat.type === 'buzzer') {
                        return `<div class="min-h-screen bg-gradient-to-br from-pink-900 to-purple-900 text-white p-12"><div class="max-w-6xl mx-auto text-center">
                        <div class="flex justify-between items-center mb-8">
                        <div class="text-2xl font-bold bg-white/20 px-6 py-3 rounded-full">LEVEL ${d.currentLevel}/5</div>
                        <div class="text-4xl font-bold bg-yellow-400 text-gray-900 px-8 py-3 rounded-full">${cat.icon} ${cat.name}</div>
                        <div class="text-2xl font-bold bg-green-500 px-6 py-3 rounded-full">ğŸ’ ${this.calculatePoints()}</div>
                        </div>
                        <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-12 mb-8">
                        <div class="text-3xl mb-8"><p class="mb-4">${q.cz}</p><p class="text-blue-200">${q.it}</p></div>
                        ${q.image ? `<img src="${q.image}" style="max-width: 600px; max-height: 600px;" class="mx-auto rounded-lg mb-8">` : `<div class="text-9xl mb-8">${q.visual}</div>`}
                        ${!d.buzzer ? '<p class="text-2xl text-yellow-300 animate-pulse font-oswald">ÄŒekÃ¡me na buzzer... / Aspettiamo il buzzer...</p>' : `<div class="text-3xl font-bold mb-8">ğŸ”” ${d.teams[d.buzzer].name}</div>`}
                        </div>
                        ${d.buzzer ? `<div class="flex gap-6 justify-center">
                        <button onclick="app.awardPoints('${d.buzzer}',${cat.points * d.currentLevel})" class="bg-green-500 text-2xl font-bold py-4 px-12 rounded-xl">âœ“ SprÃ¡vnÄ›</button>
                        <button onclick="app.nextQuestion()" class="bg-red-500 text-2xl font-bold py-4 px-12 rounded-xl">âœ— Å patnÄ›</button>
                        ` : ''}
                        </div></div></div>`;
                    } else {
                        const team1Answered = d.answers && d.answers[`team1-${d.currentLevel}-${d.currentCategory}`] !== undefined;
                        const team2Answered = d.answers && d.answers[`team2-${d.currentLevel}-${d.currentCategory}`] !== undefined;
                        const bothAnswered = team1Answered && team2Answered;
                        const showCorrect = d.showCorrect || false;
                        
                        let timerColor = 'text-green-400';
                        if (d.timer <= 20) timerColor = 'text-red-400 timer-pulse';
                        else if (d.timer <= 40) timerColor = 'text-yellow-400';
                        
                        return `<div class="min-h-screen bg-gradient-to-br from-indigo-900 to-pink-900 text-white p-8"><div class="max-w-7xl mx-auto">
                        <div class="flex justify-between items-center mb-8">
                        <div class="text-2xl font-bold bg-white/20 px-6 py-3 rounded-full">LEVEL ${d.currentLevel}/5</div>
                        <div class="text-4xl font-bold bg-yellow-400 text-gray-900 px-8 py-3 rounded-full">${cat.icon} ${cat.name}</div>
                        <div class="text-2xl font-bold bg-green-500 px-6 py-3 rounded-full">ğŸ’ ${this.calculatePoints()}</div>
                        </div>
                        
                        ${!isLevel1 && d.timerActive ? `<div class="text-center mb-8"><div class="text-6xl font-bold ${timerColor} font-oswald">${d.timer}s</div></div>` : ''}
                        
                        <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-12 mb-8">
                        <div class="text-3xl text-center mb-8"><p class="mb-4">${q.cz}</p><p class="text-blue-200">${q.it}</p></div>
                        
                        ${!isLevel1 && q.hints && d.hintsShown > 0 ? `<div class="mb-8 text-center text-2xl text-yellow-300">${q.hints[d.hintsShown-1].content.startsWith('data:image') || q.hints[d.hintsShown-1].content.startsWith('https://') ? `<img src="${q.hints[d.hintsShown-1].content}" class="mx-auto rounded-lg" style="max-width: 300px; max-height: 300px;" alt="NÃ¡povÄ›da">` : q.hints[d.hintsShown-1].content}</div>` : ''}
                        
                        <div class="grid grid-cols-2 gap-6 mb-8">
                        ${q.answers.map((a,i)=>`<div class="text-2xl font-bold py-8 px-6 rounded-xl text-center transition-all ${showCorrect && i===q.correct ? 'bg-green-500 ring-4 ring-green-300 scale-105' : 'bg-white/20'}">
                        <span class="text-yellow-400 text-3xl mr-3">${String.fromCharCode(65+i)}</span>${a}</div>`).join('')}
                        </div>
                        
                        <div class="grid grid-cols-2 gap-6 mb-8">
                        <div class="p-6 rounded-xl ${team1Answered ? 'bg-green-500' : 'bg-red-500/50'}">
                        <p class="text-2xl font-bold text-center">${team1Answered ? 'âœ“' : 'ğŸ”´'} ${d.teams.team1.name}</p>
                        <p class="text-xl text-center">${team1Answered ? 'OdpovÄ›dÄ›l / Ha risposto' : 'ÄŒekÃ¡me / Aspettiamo'}</p>
                        </div>
                        <div class="p-6 rounded-xl ${team2Answered ? 'bg-green-500' : 'bg-red-500/50'}">
                        <p class="text-2xl font-bold text-center">${team2Answered ? 'âœ“' : 'ğŸ”´'} ${d.teams.team2.name}</p>
                        <p class="text-xl text-center">${team2Answered ? 'OdpovÄ›dÄ›l / Ha risposto' : 'ÄŒekÃ¡me / Aspettiamo'}</p>
                        </div>
                        </div>
                        </div>
                        
                        <div class="text-center">
                        ${!showCorrect && bothAnswered ? `
                        <button onclick="app.showCorrectAnswer()" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-gray-900 text-3xl font-bold py-6 px-16 rounded-2xl hover:scale-105 transition-all shadow-2xl font-oswald mb-4">
                        ğŸ“‹ ZOBRAZIT SPRÃVNOU ODPOVÄšÄ
                        </button>` : ''}
                        ${showCorrect ? `
                        <button onclick="app.nextQuestion()" class="bg-gradient-to-r from-green-400 to-blue-500 text-3xl font-bold py-6 px-16 rounded-2xl font-oswald hover:scale-105 transition-all">
                        â¡ï¸ DALÅ Ã OTÃZKA
                        </button>` : ''}
                        ${!isLevel1 && !bothAnswered && !d.timerActive ? `
                        <button onclick="app.startTimer()" class="bg-gradient-to-r from-blue-400 to-purple-500 text-3xl font-bold py-6 px-16 rounded-2xl font-oswald hover:scale-105 transition-all">
                        â±ï¸ SPUSTIT ÄŒASOVAÄŒ
                        </button>` : ''}
                        </div>
                        </div></div>`;
                    }
                }
                
                if (d.gameState === 'levelEnd') {
                    return `<div class="min-h-screen bg-gradient-to-br from-green-900 to-blue-900 text-white flex items-center justify-center p-12">
                    <div class="max-w-4xl w-full text-center">
                    <div class="text-9xl mb-8">ğŸ‰</div>
                    <h1 class="text-6xl font-bold mb-12 font-oswald">LEVEL ${d.currentLevel} DOKONÄŒEN!</h1>
                    <div class="grid grid-cols-2 gap-8 mb-12">
                    <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8">
                    <p class="text-3xl font-bold mb-4">${d.teams.team1.name}</p>
                    <p class="text-7xl font-bold text-yellow-400">${d.teams.team1.score}</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8">
                    <p class="text-3xl font-bold mb-4">${d.teams.team2.name}</p>
                    <p class="text-7xl font-bold text-yellow-400">${d.teams.team2.score}</p>
                    </div>
                    </div>
                    <button onclick="app.nextLevel()" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-gray-900 text-4xl font-bold py-8 px-16 rounded-2xl font-oswald hover:scale-105 transition-all">
                    ${d.currentLevel < 5 ? 'â¡ï¸ DALÅ Ã LEVEL' : 'ğŸ† VÃSLEDKY'}
                    </button>
                    </div></div>`;
                }
                
                if (d.gameState === 'finished') {
                    const winner = d.teams.team1.score > d.teams.team2.score ? d.teams.team1 : 
                                  d.teams.team2.score > d.teams.team1.score ? d.teams.team2 : null;
                    return `<div class="min-h-screen bg-gradient-to-br from-yellow-900 to-orange-900 text-white flex items-center justify-center p-12">
                    <div class="max-w-4xl w-full text-center">
                    <div class="text-9xl mb-8">ğŸ†</div>
                    <h1 class="text-7xl font-bold mb-12 font-oswald">HRA SKONÄŒILA!</h1>
                    ${winner ? `<h2 class="text-5xl font-bold mb-12 text-yellow-300">ğŸ‰ ${winner.name} VYHRÃVÃ! ğŸ‰</h2>` : '<h2 class="text-5xl font-bold mb-12">ğŸ¤ REMÃZA!</h2>'}
                    <div class="grid grid-cols-2 gap-8 mb-12">
                    <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8">
                    <p class="text-3xl font-bold mb-4">${d.teams.team1.name}</p>
                    <p class="text-8xl font-bold text-yellow-400">${d.teams.team1.score}</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8">
                    <p class="text-3xl font-bold mb-4">${d.teams.team2.name}</p>
                    <p class="text-8xl font-bold text-yellow-400">${d.teams.team2.score}</p>
                    </div>
                    </div>
                    </div></div>`;
                }
            }

            renderTeam() {
                const d = this.gameData;
                
                if (!this.teamId) {
                    const team1Taken = d.teams.team1.ready;
                    const team2Taken = d.teams.team2.ready;
                    
                    return `<div class="min-h-screen bg-gradient-to-br from-purple-900 to-indigo-900 text-white p-8"><div class="max-w-2xl mx-auto">
                    <div class="text-center mb-12"><div class="text-8xl mb-6">ğŸŒ</div><h1 class="text-5xl font-bold mb-4 font-oswald">VYBERTE TÃM</h1></div>
                    <div class="grid gap-6">
                    <button onclick="app.joinTeam('team1')" ${team1Taken ? 'disabled' : ''} class="relative ${team1Taken ? 'bg-gray-600 opacity-50 cursor-not-allowed' : 'bg-gradient-to-r from-blue-500 to-purple-600 hover:scale-105'} text-3xl font-bold py-12 px-8 rounded-2xl font-oswald transition-all">
                    ğŸ”µ ${d.teams.team1.name}
                    ${team1Taken ? '<div class="text-xl mt-2">âŒ Obsazeno / Occupato</div>' : ''}
                    </button>
                    <button onclick="app.joinTeam('team2')" ${team2Taken ? 'disabled' : ''} class="relative ${team2Taken ? 'bg-gray-600 opacity-50 cursor-not-allowed' : 'bg-gradient-to-r from-green-500 to-teal-600 hover:scale-105'} text-3xl font-bold py-12 px-8 rounded-2xl font-oswald transition-all">
                    ğŸŸ¢ ${d.teams.team2.name}
                    ${team2Taken ? '<div class="text-xl mt-2">âŒ Obsazeno / Occupato</div>' : ''}
                    </button>
                    </div></div></div>`;
                }
                
                if (d.gameState === 'welcome' || d.gameState === 'countdown') {
                    return `<div class="min-h-screen bg-gradient-to-br from-purple-900 to-indigo-900 text-white flex items-center justify-center p-12">
                    <div class="text-center">
                    <div class="text-9xl mb-8">â³</div>
                    <h1 class="text-5xl font-bold font-oswald">ÄŒekÃ¡me na start...<br>Aspettiamo l'inizio...</h1>
                    </div></div>`;
                }
                
                if (d.gameState === 'playing') {
                    if (!d.currentCategory) {
                        return `<div class="min-h-screen bg-gradient-to-br from-indigo-900 to-purple-900 text-white flex items-center justify-center p-12">
                        <div class="text-center">
                        <div class="text-9xl mb-8">ğŸ¯</div>
                        <h1 class="text-5xl font-bold font-oswald">Vyberte kategorii...<br>Scegli la categoria...</h1>
                        </div></div>`;
                    }
                    
                    const cat = CATEGORIES.find(c => c.id === d.currentCategory);
                    const q = QUESTIONS[d.currentCategory][d.currentLevel];
                    const isLevel1 = d.currentLevel === 1;
                    const answerKey = `${this.teamId}-${d.currentLevel}-${d.currentCategory}`;
                    const hasAnswered = d.answers && d.answers[answerKey] !== undefined;
                    
                    if (cat.type === 'buzzer') {
                        const canBuzz = !d.buzzer;
                        return `<div class="min-h-screen bg-gradient-to-br from-pink-900 to-purple-900 text-white p-8"><div class="max-w-3xl mx-auto">
                        <div class="text-center mb-8">
                        <div class="text-2xl font-bold bg-white/20 px-6 py-3 rounded-full inline-block">LEVEL ${d.currentLevel}/5</div>
                        <div class="text-3xl font-bold mt-4">${cat.icon} ${cat.name}</div>
                        <div class="text-xl font-bold mt-2 text-yellow-400">ğŸ’ ${this.calculatePoints()}</div>
                        </div>
                        <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 mb-8">
                        <div class="text-2xl text-center mb-8"><p class="mb-3">${q.cz}</p><p class="text-blue-200">${q.it}</p></div>
                        ${q.image ? `<img src="${q.image}" style="max-width: 400px; max-height: 400px;" class="mx-auto rounded-lg mb-8">` : `<div class="text-9xl text-center mb-8">${q.visual}</div>`}
                        </div>
                        ${canBuzz ? `
                        <button onclick="app.pressBuzzer('${this.teamId}')" class="w-full bg-gradient-to-r from-red-500 to-orange-500 text-white text-4xl font-bold py-12 rounded-2xl hover:scale-105 transition-all shadow-2xl font-oswald animate-pulse">
                        ğŸ”” BUZZER!
                        </button>` : `<div class="text-center text-2xl text-yellow-300">ÄŒekÃ¡me na buzzer...<br>Aspettiamo il buzzer...</div>`}
                        </div></div>`;
                    } else {
                        if (hasAnswered) {
                            return `<div class="min-h-screen bg-gradient-to-br from-indigo-900 to-pink-900 text-white flex items-center justify-center p-12">
                            <div class="text-center">
                            <div class="text-9xl mb-8">âœ“</div>
                            <h1 class="text-5xl font-bold font-oswald">OdpovÄ›Ä odeslÃ¡na!<br>Risposta inviata!</h1>
                            </div></div>`;
                        }
                        
                        let timerColor = 'text-green-400';
                        if (d.timer <= 20) timerColor = 'text-red-400';
                        else if (d.timer <= 40) timerColor = 'text-yellow-400';
                        
                        return `<div class="min-h-screen bg-gradient-to-br from-indigo-900 to-pink-900 text-white p-8"><div class="max-w-3xl mx-auto">
                        <div class="text-center mb-8">
                        <div class="text-2xl font-bold bg-white/20 px-6 py-3 rounded-full inline-block mb-4">LEVEL ${d.currentLevel}/5</div>
                        <div class="text-3xl font-bold">${cat.icon} ${cat.name}</div>
                        <div class="text-xl font-bold mt-2 text-yellow-400">ğŸ’ ${this.calculatePoints()}</div>
                        ${!isLevel1 && d.timerActive ? `<div class="text-5xl font-bold ${timerColor} mt-4">â±ï¸ ${d.timer}s</div>` : ''}
                        </div>
                        
                        <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 mb-8">
                        <div class="text-2xl text-center mb-8"><p class="mb-3">${q.cz}</p><p class="text-blue-200">${q.it}</p></div>
                        
                        ${!isLevel1 && d.hintsShown > 0 && q.hints ? `<div class="bg-yellow-400/20 border-2 border-yellow-400 rounded-xl p-4 mb-4 text-xl text-yellow-300">
                        ${q.hints[d.hintsShown-1].content.startsWith('data:image') || q.hints[d.hintsShown-1].content.startsWith('https://') ? `<img src="${q.hints[d.hintsShown-1].content}" class="mx-auto rounded-lg" style="max-width: 200px; max-height: 200px;" alt="NÃ¡povÄ›da">` : q.hints[d.hintsShown-1].content}
                        </div>` : ''}
                        
                        <div class="grid grid-cols-1 gap-4">
                        ${q.answers.map((a,i)=>`<button onclick="app.submitAnswer('${this.teamId}',${i})" class="bg-gradient-to-r from-blue-500 to-purple-600 text-xl font-bold py-6 px-6 rounded-xl hover:scale-105 transition-all">
                        <span class="text-yellow-400 text-2xl mr-3">${String.fromCharCode(65+i)}</span>${a}
                        </button>`).join('')}
                        </div>
                        </div>
                        </div></div>`;
                    }
                }
                
                if (d.gameState === 'levelEnd' || d.gameState === 'finished') {
                    return `<div class="min-h-screen bg-gradient-to-br from-green-900 to-blue-900 text-white flex items-center justify-center p-12">
                    <div class="text-center">
                    <div class="text-9xl mb-8">â³</div>
                    <h1 class="text-5xl font-bold font-oswald">ÄŒekÃ¡me na dalÅ¡Ã­ level...<br>Aspettiamo il prossimo livello...</h1>
                    </div></div>`;
                }
            }
        }

        app = new QuizApp();
        
        }); // End of window.load event
    </script>
</body>
</html>